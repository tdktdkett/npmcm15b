function betaShape = tCopulaSpearmanUtil(nu)
%TCOPULASPEARMANUTIL Utility for approximating Spearman's rho for t copula.
% Utility for approximating Spearman's rho as a function of the linear
% correlation parameter in a t copula with nu degrees of freedom.  The output
% is the shape param of a symmetric beta CDF used to transform rho in the
% approximation
%
%    rhoTilde = 2*betainc((rho+1)/2,betaShape,betaShape) - 1
%    rho_s = 2.*asin(rhoTilde)./pi
%
% Absolute error |trueValue - approximation| < 1e-3 for nu > 7,
%                                            < 3e-3 for nu > .05,
%                                            becomes less accurate as nu -> 0.
%
% An alternative approximation is numerical quadrature using the definition of
% Spearman's rho:
%
%    Rho = [1 rho; rho 1];
%    r = 12*integral2(@C,0,1,0,1,'Method','tiled') - 3;
%
%    function p = C(u,v)
%        t = [tinv(u(:),nu),tinv(v(:),nu)];
%        p = reshape(mvtcdf(t,Rho,nu),size(u));
%    end

%   Copyright 2012 The MathWorks, Inc.


nuTable = [0.0441941738241592  0.0525560259533572  0.0625  0.0743254446876701 ...
           0.0883883476483184  0.105112051906714   0.125   0.14865088937534   ...
           0.176776695296637   0.210224103813429   0.25    0.29730177875068   ...
           0.353553390593274   0.420448207626857   0.5     0.594603557501361  ...
           0.707106781186547   0.840896415253715   1       1.4142135623731    ...
           2                   2.82842712474619    4       5.65685424949238   ...
           8                  11.3137084989848     16     22.6274169979695    ...
           32                 45.254833995939      64     90.5096679918781    ...
           128               181.019335983756      256    362.038671967512    ...
           512               724.077343935025      1024  1448.15468787005     ...
           2048             2896.3093757401        4096  5792.6187514802      ...
           8192            32768];
paramTable = [0.549004247412085  0.553223406616598  0.558193075936287  0.564034970477223 ...
              0.570884785801172  0.578889340069145  0.588208364136517  0.599003074411303 ...
              0.61143296258524   0.625564949959516  0.64157087970525   0.659514595288783 ...
              0.679320876486599  0.700854803808033  0.72379925660789   0.747684309538454 ...
              0.773257161211222  0.798471894580871  0.822926008701324  0.868049791548401 ...
              0.905283476132899  0.933680997230112  0.954135752469301  0.968367648217827 ...
              0.978142228722572  0.984839628171176  0.989438840933144  0.992615750990808 ...
              0.99482175661251   0.996360407024622  0.997437579836696  0.998193739261478 ...
              0.998725628759712  0.999100320227444  0.999364560190588  0.999551045894623 ...
              0.999682731088251  0.999775758385658  0.999841493647545  0.999887953046709 ...
              0.999920793622732  0.999944008234888  0.999960421677679  0.999972026329488 ...
              0.999980337359011  1];
% Levels off at ~0.5261 for very small nu
betaShape = exp(spline(nuTable,log(paramTable),nu));
betaShape(nu > 32768) = 1;
